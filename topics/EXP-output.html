<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How the EXP N-body code selects what and when to write data &mdash; EXP 0.172 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=9c6809b7"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=5eb1bb1e"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to configure a razor-thin disk" href="flatdisk.html" />
    <link rel="prev" title="The EXP phase-space format" href="exp-phase-space.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            EXP
              <img src="../_static/exp_logo_white.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                7.x
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">First steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/overview.html">EXP at a glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/install.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/tutorial.html">Tutorials</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EXP concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bfetheory.html">BFE theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="codeintro.html">Code intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="timesseries.html">BFE time series analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units in EXP and pyEXP</a></li>
<li class="toctree-l1"><a class="reference internal" href="multistep.html">N-Body optimization in EXP</a></li>
<li class="toctree-l1"><a class="reference internal" href="centering.html">Centering</a></li>
<li class="toctree-l1"><a class="reference internal" href="yamlconfig.html">What is YAML?</a></li>
<li class="toctree-l1"><a class="reference internal" href="yamlconfig.html#an-annotated-exp-yaml-configuration">An annotated EXP YAML configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="howtosim.html">How to run your own N-body simulation in EXP</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Frequently Asked Questions (FAQ)</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Are there pre-compiled versions of pyEXP and EXP?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#i-only-want-pyexp-do-i-need-c-to-compile-exp">I only want pyEXP, do I need C++ to compile EXP?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#why-would-i-use-exp-rather-than-pyexp">Why would I use EXP rather than pyEXP?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#what-hardware-do-i-need-to-run-exp-and-pyexp">What hardware do I need to run EXP and pyEXP?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#how-do-i-restart-exp-from-a-checkpoint">How do I restart EXP from a checkpoint?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#my-hpc-cluster-does-not-have-the-required-dependencies-what-are-my-options">My HPC cluster does not have the required dependencies.  What are my options?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#can-i-run-exp-or-pyexp-in-a-container">Can I run EXP or pyEXP in a container?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#i-got-a-seg-fault-now-what-do-i-do">I got a “seg fault”, now what do I do?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#how-can-i-do-a-calculation-with-phase-space-in-pyexp">How can I do a calculation with phase space in pyEXP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html#what-do-these-parameters-mean">What do these parameters mean?</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">How to solve specific problems</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="visualizing-bases.html">How to visualize the BFE bases used to make your coefficients</a></li>
<li class="toctree-l1"><a class="reference internal" href="making-coefficients.html">How to  generate coefficients from phase-space snapshots</a></li>
<li class="toctree-l1"><a class="reference internal" href="saving-coefficients.html">How to save and reuse your newly generated coefficients</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualizing-fields.html">How to convert your coefficients back to physical fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="make-movies.html">Making movies of your BFE field quantities</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-mssa.html">How to use mSSA with your coefficient series in pyEXP</a></li>
<li class="toctree-l1"><a class="reference internal" href="orbits.html">Generating orbits in your BFE potential fields</a></li>
<li class="toctree-l1"><a class="reference internal" href="replay.html">Replaying a simulation using EXP</a></li>
<li class="toctree-l1"><a class="reference internal" href="exp-phase-space.html">The EXP phase-space format</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How the EXP N-body code selects what and when to write data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#output-modules">Output modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#an-example">An example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-new-output-routines">Adding new output routines</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flatdisk.html">How to configure a razor-thin disk</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debugging EXP</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extending EXP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="design.html">Software design goals and features</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html#overall-organization-of-the-code">Overall organization of the code</a></li>
<li class="toctree-l1"><a class="reference internal" href="design.html#parallel-usage">Parallel usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="usermodules.html">User modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="newforces.html">How to make a new EXP force</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">More about EXP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../news.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to EXP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../doxygen.html">Index to C++ classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pybind11.html">Index to pyEXP classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versioning.html">Versioning and API stability</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">EXP</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How the EXP N-body code selects what and when to write data</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/topics/EXP-output.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="how-the-exp-n-body-code-selects-what-and-when-to-write-data">
<span id="exp-output"></span><h1>How the EXP N-body code selects what and when to write data<a class="headerlink" href="#how-the-exp-n-body-code-selects-what-and-when-to-write-data" title="Link to this heading"></a></h1>
<section id="output-modules">
<h2>Output modules<a class="headerlink" href="#output-modules" title="Link to this heading"></a></h2>
<p>The <cite>OutputContainer</cite> class contains a list of instances of
classes that gather information about the running simulation as
described in <a class="reference internal" href="codeintro.html#code-intro"><span class="std std-ref">the code intro</span></a>.  Every <cite>Output</cite> module has a
frequency parameter <cite>nint</cite> which specifies the number of time
steps between running the output process.  Many of the routines also
take a <cite>filename</cite> argument to override the default file name
generation, which is most often formed from a combination of the
runtag and the output module name.  Here is a brief description of the
output modules.  For details on the available arguments, please see
the Doxygen generated man pages or the source code itself.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">outlog</span></code> produces a simple summary of the running simulation that
includes the center of mass position and velocities, angular
momenta, kinetic and potential energies for the total phase space
and each component separately.  It also lists the wall-clock time
for each step.  The file name can be specified with the <code class="docutils literal notranslate"><span class="pre">filename</span></code>
parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outps,</span> <span class="pre">outpsn,</span> <span class="pre">outpsp,</span> <span class="pre">outpsq,</span> <span class="pre">outchkpt,</span> <span class="pre">outchkptq</span></code> produce
phase-space dumps. The first method appends successive dumps to the
same file.  The second and third methods generate an individual
sequentially numbered file for each call.  The <code class="docutils literal notranslate"><span class="pre">outpsn</span></code> uses a
native phase-space consolidation routine which gather all phase
space at the root node before writing.  The <code class="docutils literal notranslate"><span class="pre">outpsp</span></code> uses MPI-IO
to write phase-space files. This will be faster if you have fast,
parallel network hardware. All of the floating data fields are
written as 4-byte floats (single precision).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outpsq</span></code> is the parallel version of <cite>outpsp</cite>, it results in split
PSP files prefixed by <code class="docutils literal notranslate"><span class="pre">SPL</span></code> rather than the <code class="docutils literal notranslate"><span class="pre">OUT</span></code> for
<code class="docutils literal notranslate"><span class="pre">outps</span></code>. This format is recommended for large phase spaces, as it
can be much faster if your HPC center has a parallel file system.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outchkpt</span></code> is a version of <code class="docutils literal notranslate"><span class="pre">outpsp</span></code> that writes floating fields as
8-byte floats whose primary use is restarting your simulation with
full information.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outchkptq</span></code> is a version of <code class="docutils literal notranslate"><span class="pre">outchkpt</span></code> that writes 8-byte floats in
<code class="docutils literal notranslate"><span class="pre">SPL</span></code> split format. This is the recommended check-point format for
runs with <span class="math notranslate nohighlight">\(N&gt;10^6\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outascii</span></code> emits phase-space snapshots for a single name-specified
component at regular intervals in ascii format.  Each line contains:
<code class="docutils literal notranslate"><span class="pre">mass,</span> <span class="pre">pos[3],</span> <span class="pre">vel[3],</span> <span class="pre">acc[3],</span> <span class="pre">pot,</span> <span class="pre">potext</span></code>, followed by the
attribute arrays <code class="docutils literal notranslate"><span class="pre">ival[niattr],</span> <span class="pre">dval[ndattr]</span></code>. Like <code class="docutils literal notranslate"><span class="pre">outpsn</span></code>, each
snapshot is written into a file with a sequentially increasing
counter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outcoef</span></code> writes the basis coefficients in binary
format for the specified component at the desired frequency
<code class="docutils literal notranslate"><span class="pre">nint</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">outfrac</span></code> provides the radius containing the specified mass fraction
for each specified component and frequency.  This method will work
for any component but makes the most sense for near-equilibrium
galaxy components such as disks, bulges and halos.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">orbtrace</span></code> will output a select number of orbits to the same file,
appending phase space information to the end at each time step. This
is helpful for quick looks, but is not meant to be science product
output (i.e. one should probably not try to set <code class="docutils literal notranslate"><span class="pre">orbtrace</span></code> to the
number of disk particles).</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SPL</span></code> and <code class="docutils literal notranslate"><span class="pre">OUT</span></code> prefixes are for humans.  EXP does not use
these names to distinguish between <code class="docutils literal notranslate"><span class="pre">SPL</span></code> and <code class="docutils literal notranslate"><span class="pre">OUT</span></code> files.</p>
</div>
</section>
<section id="an-example">
<h2>An example<a class="headerlink" href="#an-example" title="Link to this heading"></a></h2>
<p>We provided a simple example of output stanzas in <a class="reference internal" href="yamlconfig.html#yamlconfig"><span class="std std-ref">the sample
YAML config</span></a>.
Here is a more complex specification with a bit of additional
explanation:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">Output</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outlog</span>
<span class="w">    </span><span class="nt">parameters </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">nint </span><span class="p">:</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outpsn</span>
<span class="w">    </span><span class="nt">parameters </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">nint </span><span class="p">:</span><span class="w"> </span><span class="nv">10</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outchkpt</span>
<span class="w">    </span><span class="nt">parameters </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">nint </span><span class="p">:</span><span class="w"> </span><span class="nv">100</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outcoef</span>
<span class="w">    </span><span class="nt">parameters </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">filename </span><span class="p">:</span><span class="w"> </span><span class="nv">outcoef.star</span><span class="p p-Indicator">,</span><span class="nt"> name </span><span class="p">:</span><span class="w"> </span><span class="nv">star</span><span class="p p-Indicator">,</span><span class="nt"> nint </span><span class="p">:</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id </span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">outcoef</span>
<span class="w">    </span><span class="nt">parameters </span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">filename </span><span class="p">:</span><span class="w"> </span><span class="nv">outcoef.dark</span><span class="p p-Indicator">,</span><span class="nt"> name </span><span class="p">:</span><span class="w"> </span><span class="nv">dark</span><span class="p p-Indicator">,</span><span class="nt"> nint </span><span class="p">:</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>For the first three output types, <cite>nint=xx</cite> is the time-step
frequency for output.  EXP will write basic global diagnostics at
every step, will write standard (low-precision) phase-space dumps
after each 10 steps and a high-precision phase-space dump suitable for
a restart after every 100 steps.  In addition, coefficient files will
be saved for a disk component named <cite>star</cite> and a halo component
named <cite>dark</cite> after every step into files named
<cite>outcoef.star</cite> and <cite>outcoef.dark</cite>, respectively.</p>
</section>
<section id="adding-new-output-routines">
<h2>Adding new output routines<a class="headerlink" href="#adding-new-output-routines" title="Link to this heading"></a></h2>
<p>In short, the steps are as follows.  Suppose that you want a new
output routine that we will call <cite>OutTest</cite>.</p>
<ul class="simple">
<li><p>Begin with one of the existing output routines (e.g. <cite>OutLog</cite>) and
rename both the corresponding <cite>OutTest.H</cite> and <cite>OutTest.cc</cite> file for
your use.</p></li>
<li><p>Change the name of class to <cite>OutTest</cite> inside the source files and
add your new functionality.</p></li>
<li><p>Add the <cite>#include &lt;OutText.H&gt;</cite> to the top <cite>OutputContainer.cc</cite> and
also add a parsing stanza that will create a new instance of your
output class following the example for <cite>OutLog</cite>.</p></li>
<li><p>Add the <cite>OutText.cc</cite> to the <cite>exp_SOURCES</cite> list
inside of <cite>CMakeLists.txt</cite> in the <cite>src</cite>} directory.</p></li>
<li><p>Compile, test, and debug as necessary.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="exp-phase-space.html" class="btn btn-neutral float-left" title="The EXP phase-space format" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="flatdisk.html" class="btn btn-neutral float-right" title="How to configure a razor-thin disk" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2025, EXP-code collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>